âœ… Ziel: Bild komprimieren, korrekt in Firebase Storage hochladen, URL speichern
ğŸ“ Datei: firebase.ts
ğŸ”§ Schritt 1 â€“ uploadUserAvatar() richtig implementieren:
ts
Kopieren
Bearbeiten
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";

// Komprimierte Datei als Blob Ã¼bergeben
export const uploadUserAvatar = async (file: File, userId: string): Promise<string> => {
  const storage = getStorage();
  const storageRef = ref(storage, `avatars/${userId}-${file.name}`);
  const snapshot = await uploadBytes(storageRef, file);
  const downloadUrl = await getDownloadURL(snapshot.ref);
  return downloadUrl;
};
ğŸ“ Datei: ProfileScreen.tsx (und Ã¤hnliche wie InitialSetupModal.tsx)
ğŸ”§ Schritt 2 â€“ Bild vor dem Upload komprimieren (max. 0.5MB, 600x600px):
Installieren (falls nicht da):

bash
Kopieren
Bearbeiten
npm install browser-image-compression
Dann im Code:

ts
Kopieren
Bearbeiten
import imageCompression from "browser-image-compression";

const compressImage = async (file: File): Promise<File> => {
  const options = {
    maxSizeMB: 0.5,
    maxWidthOrHeight: 600,
    useWebWorker: true,
  };
  return await imageCompression(file, options);
};
ğŸ”§ Schritt 3 â€“ Upload korrekt vor dem Speichern durchfÃ¼hren:
tsx
Kopieren
Bearbeiten
const handleSave = async () => {
  setSaving(true);
  try {
    let avatarUrl = currentUser.avatarUrl;

    if (selectedFile) {
      const compressed = await compressImage(selectedFile);
      avatarUrl = await uploadUserAvatar(compressed, currentUser.uid);
    }

    await updateUserProfile(currentUser.uid, {
      username,
      location,
      avatarUrl,
    });

    toast({ title: "Profil gespeichert." });
  } catch (err) {
    console.error("Fehler beim Speichern", err);
    toast({ title: "Fehler beim Speichern", description: err.message });
  } finally {
    setSaving(false);
  }
};
ğŸ’¡ Hinweise:
uploadUserAvatar() arbeitet jetzt direkt mit echten Dateien (Blob), nicht mit base64.

Nur die URL wird in Firestore gespeichert â†’ keine 1MB-Grenze mehr.

Kompression reduziert DateigrÃ¶ÃŸe ohne visuelle EinbuÃŸen, ideal fÃ¼r mobile Nutzung.